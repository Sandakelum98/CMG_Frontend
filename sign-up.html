<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Sign up to Stitch-Line</title>
    <link rel="stylesheet" type="text/css" href="css/lib.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&family=Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
</head>
<body class="home">
<div id="main">

    <div class="content">
        <h2 class="title text-center">Sign up to Stitch-Line</h2>

        <div class="signin-form">

            <div class="container">

                <div class="row text-center">
                    <div class="mb-3 user-tab customer-tab">
                        <p>As Customer</p>
                    </div>
                    <div class="mb-3 user-tab admin-tab">
                        <p>As Admin</p>
                    </div>
                </div>

                <div class="row">
                    <div class="mb-3 txt-container">
                        <label for="txt-name" class="form-label">Name</label>
                        <input type="text" class="form-control" id="txt-name" aria-describedby="emailHelp">
                        <p id="usernameHelp" class="form-text">Invalid username</p>
                    </div>

                    <div class="mb-3 txt-container">
                        <label for="txt-email" class="form-label">Username</label>
                        <input type="text" class="form-control" id="txt-username" aria-describedby="emailHelp">
                        <!--<div id="usernameHelp" class="form-text">Invalid password</div>-->
                    </div>
                </div>

                <div class="row">
                    <div class="mb-3 txt-container address-container">
                        <label for="txt-address" class="form-label">Address</label>
                        <input type="text" class="form-control" id="txt-address" aria-describedby="emailHelp">
                        <!--<div id="passwordHelp" class="form-text">Invalid password</div>-->
                    </div>

                    <div class="mb-3 txt-container nic-container">
                        <label for="txt-nic" class="form-label">NIC</label>
                        <input type="text" class="form-control" id="txt-nic" aria-describedby="emailHelp">
                        <div id="nicHelp" class="form-text">Invalid nic</div>
                    </div>

                    <div class="mb-3 txt-container">
                        <label for="txt-mobileno" class="form-label">Mobile No</label>
                        <input type="text" class="form-control" id="txt-mobileno" aria-describedby="emailHelp">
                        <div id="mobilenoHelp" class="form-text">Invalid mobile no</div>
                    </div>
                </div>

                <div class="row">
                    <div class="mb-3 txt-container fit-to-row">
                        <label for="txt-email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="txt-email" aria-describedby="emailHelp">
                        <div id="emailHelp" class="form-text">Invalid password</div>
                    </div>

                    <div class="mb-3 txt-container employeeNo-container">
                        <label for="txt-employeeNo" class="form-label">Employee No</label>
                        <input type="text" class="form-control" id="txt-employeeNo" aria-describedby="emailHelp">
                        <div id="employeeNoHelp" class="form-text">Invalid mobile no</div>
                    </div>
                </div>

                <div class="row">
                    <div class="mb-3 txt-container">
                        <label for="txt-password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="txt-password" aria-describedby="emailHelp">
                        <div id="passwordHelp" class="form-text">Invalid password</div>
                    </div>

                    <div class="mb-3 txt-container">
                        <label for="txt-confirm-password" class="form-label">Confirm Password</label>
                        <input type="password" class="form-control" id="txt-confirm-password" aria-describedby="emailHelp">
                        <div id="confirmPasswordHelp" class="form-text">Invalid mobile no</div>
                    </div>
                </div>

                <div class="row">
                    <button type="button" class="btn btn-primary btn-signin btn-signup" id="btnSignup">Sign up</button>
                </div>

            </div>

        </div>

        <div>
            <p class="signup-link text-center">Already do you have account? <a href="index.html">Go back to login</a>
            </p>
        </div>

    </div>


</div>

<script type="text/javascript" src="js/jquery.min.js"></script>
<script>

    $('.form-text').hide();
    $('.nic-container').hide();
    $('.employeeNo-container').hide();

    var currentTab = 0;

    $('.admin-tab').on("click", function () {
        $('body').addClass('admin-tab-opened');
        $('input').css('border', '1px solid #0d1117');
        $('.nic-container').show();
        $('.employeeNo-container').show();

        $('.address-container').hide();

        currentTab = 1;
        clear()

    });

    $('.customer-tab').on("click", function () {
        $('body').removeClass('admin-tab-opened');
        $('input').css('border', '1px solid #0d1117');
        $('.nic-container').hide();
        $('.employeeNo-container').hide();

        $('.address-container').show();

        currentTab = 0;
        clear();
    });

    //--------------------CLEAR--------------------
    function clear() {
        let name = $('#txt-name').val("");
        let username = $('#txt-username').val("");
        let address = $('#txt-address').val("");
        let mobileNo = $('#txt-mobileno').val("");
        let email = $('#txt-email').val("");

        let password1 = $('#txt-password').val("");
        let password2 = $('#txt-confirm-password').val("");

        let nic = $('#txt-nic').val("");
        let employeeId = $('#txt-employeeNo').val("");
    }


    //--------------------SIGN UP--------------------
    $('#btnSignup').click(function () {

        let type = "";

        if (currentTab == 0) {
            type = "customer";
        } else {
            type = "admin";
        }


        if (currentTab == 0) {

            let isCustomerValidated = userValidation();

            if (isCustomerValidated) {
                let name = $('#txt-name').val();
                let username = $('#txt-username').val();
                let address = $('#txt-address').val();
                let mobileNo = $('#txt-mobileno').val();
                let email = $('#txt-email').val();

                let password1 = $('#txt-password').val();
                let password2 = $('#txt-confirm-password').val();

                if (password1 != password2) {
                    alert("Passwords must be same !");
                    $('#txt-password').css('border', '1px solid red');
                    $('#txt-confirm-password').css('border', '1px solid red');
                } else {

                    $.ajax({
                        method: "POST",
                        url: "http://localhost:8080/api/v1/user",
                        contentType: "application/json",
                        async: true,
                        data: JSON.stringify({
                            name: name,
                            username: username,
                            address: address,
                            mobileNo: mobileNo,
                            email: email,
                            password: password1,
                            type: type
                        }),
                        success: function (response) {
                            alert("Sign up successfully !");
                            console.log(response);

                            window.location.replace('customer-dashboard.html');
                        },
                        error: function (response) {
                            //alert(response.responseJSON.data);
                        }
                    });
                }
            }

        } else {

            let isAdminValidated = userValidation();

            if (isAdminValidated) {
                let name = $('#txt-name').val();
                let username = $('#txt-username').val();
                let mobileNo = $('#txt-mobileno').val();
                let email = $('#txt-email').val();

                let password1 = $('#txt-password').val();
                let password2 = $('#txt-confirm-password').val();

                let nic = $('#txt-nic').val();
                let employeeId = $('#txt-employeeNo').val();


                if (password1 != password2) {
                    alert("Passwords must be same !");
                    $('#txt-password').css('border', '1px solid red');
                    $('#txt-confirm-password').css('border', '1px solid red');
                } else {
                    $.ajax({
                        method: "POST",
                        url: "http://localhost:8080/api/v1/user",
                        contentType: "application/json",
                        async: true,
                        data: JSON.stringify({
                            name: name,
                            username: username,
                            mobileNo: mobileNo,
                            email: email,
                            password: password1,
                            type: type,
                            nic: nic,
                            employeeId: employeeId
                        }),
                        success: function (response) {
                            alert("Sign up successfully !");
                            console.log(response);

                            //window.location.href = 'admin-dashboard.html';
                            window.location.replace('admin-dashboard.html');

                        },
                        error: function (response) {
                            alert(response.data);
                        }
                    });
                }
            }
        }
    });


    //--------------------VALIDATION--------------------
    function userValidation() {
        let userNameRegEx = /^[A-Z]{1}[a-z]{1,}( )[A-Z]{1}[a-z]{1,}$/;
        let mobileNoRegEx = /^(0)[0-9]{9}$/;
        let emailRegEx = /^[A-Za-z_]{3,}@[A-Za-z]{3,}[.]{1}[A-Za-z.]{3}$/;

        let nameValidation = "";
        let mobileNoValidation = "";
        let emailValidation = "";
        let usernameValidation = "";
        let addressValidation = true;
        let password1Validation = "";
        let password2Validation = "";

        if (userNameRegEx.test($('#txt-name').val())) {
            $("#txt-name").css('border', '1px solid #0d1117');
            nameValidation = true;
        } else {
            $("#txt-name").css('border', '1px solid red');
            nameValidation = false;
        }


        if (mobileNoRegEx.test($('#txt-mobileno').val())) {
            $("#txt-mobileno").css('border', '1px solid #0d1117');
            mobileNoValidation = true;
        } else {
            $("#txt-mobileno").css('border', '1px solid red');
            mobileNoValidation = false;
        }

        if (emailRegEx.test($('#txt-email').val())) {
            $("#txt-email").css('border', '1px solid #0d1117');
            emailValidation = true;
        } else {
            $("#txt-email").css('border', '1px solid red');
            emailValidation = false;
        }

        if ($('#txt-username').val().length <= 0) {
            $('#txt-username').css('border', '1px solid red');
            usernameValidation = false;
        } else {
            usernameValidation = true;
            $('#txt-username').css('border', '1px solid #0d1117');
        }

        if (currentTab == 0) {
            if ($('#txt-address').val().length <= 0) {
                $('#txt-address').css('border', '1px solid red');
                addressValidation = false;
            } else {
                addressValidation = true;
                $('#txt-address').css('border', '1px solid #0d1117');
            }
        }

        if ($('#txt-password').val().length <= 0) {
            $('#txt-password').css('border', '1px solid red');
            password1Validation = false;
        } else {
            password1Validation = true;
            $('#txt-password').css('border', '1px solid #0d1117');
        }

        if ($('#txt-confirm-password').val().length <= 0) {
            $('#txt-confirm-password').css('border', '1px solid red');
            password2Validation = false;
        } else {
            password2Validation = true;
            $('#txt-confirm-password').css('border', '1px solid #0d1117');
        }

        //------------------------------------------------------------------
        let nicNoRegEx = /^[1-9]{1}[0-9]{8}V$/;
        let employeeIdRegEx = /^E[0-9]{4}$/;

        let nicValidation = true;
        let employeeIdValidation = true;

        if(currentTab == 1) {

            if (nicNoRegEx.test($('#txt-nic').val())) {
                $("#txt-nic").css('border', '1px solid #0d1117');
                nicValidation = true;
            } else {
                $("#txt-nic").css('border', '1px solid red');
                nicValidation = false;
            }

            if (employeeIdRegEx.test($('#txt-employeeNo').val())) {
                $("#txt-employeeNo").css('border', '1px solid #0d1117');
                employeeIdValidation = true;
            } else {
                $("#txt-employeeNo").css('border', '1px solid red');
                employeeIdValidation = false;
            }


        }



        if (nameValidation == false) {
            return false;
        } else if (usernameValidation == false) {
            return false;
        } else if (addressValidation == false) {
            return false;
        } else if (mobileNoValidation == false) {
            return false;
        } else if (emailValidation == false) {
            return false;
        } else if (password1Validation == false) {
            return false;
        } else if (password2Validation == false) {
            return false;
        } else if (nicValidation == false) {
            return false;
        } else if (employeeIdValidation == false) {
            return false;
        }else {
            return true;
        }
    }


</script>
</body>
</html>